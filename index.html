<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEM Trailblazer Summer Bingo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1e3a8a, #3b82f6);
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            font-size: 3rem;
            font-weight: bold;
            color: #fbbf24;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 2.5rem;
            font-weight: bold;
            color: #06b6d4;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 5px;
        }

        .tagline {
            font-size: 1.5rem;
            color: #fbbf24;
            font-weight: bold;
        }

        .auth-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 30px;
            margin: 0 5px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab.active {
            background: #fbbf24;
            color: #1e3a8a;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
        }

        .btn {
            background: #fbbf24;
            color: #1e3a8a;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #f59e0b;
            transform: scale(1.05);
        }

        .btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }

        .bingo-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px;
            max-width: 600px;
            width: 100%;
            aspect-ratio: 1;
            margin: 0 auto;
            background: #8B4513;
            padding: 10px;
            border-radius: 10px;
            border: 3px solid #654321;
        }

        .bingo-cell {
            background: #dc2626;
            border: 2px solid #8B4513;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.3s;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .bingo-cell.completed {
            background: #10b981;
            border-color: #059669;
        }

        .bingo-cell.completed::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #fbbf24;
            color: #1e3a8a;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .cell-title {
            font-weight: bold;
            font-size: 14px;
            line-height: 1.2;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            margin-top: 8px;
        }

        .cell-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }

        .hidden {
            display: none;
        }

        .staff-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }

        .staff-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .staff-tab {
            padding: 10px 25px;
            margin: 0 5px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .staff-tab.active {
            background: #fbbf24;
            color: #1e3a8a;
            font-weight: bold;
        }

        .student-search {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .student-search input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            color: #333;
        }

        .verification-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .activity-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
            max-width: 600px;
            width: 100%;
            aspect-ratio: 1;
            margin-left: auto;
            margin-right: auto;
        }

        .activity-item {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 15px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            text-align: center;
            min-height: 120px;
        }

        .activity-item span {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
            font-size: 12px;
            line-height: 1.2;
        }

        .activity-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .verify-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .verify-btn.completed {
            background: #ef4444;
        }

        .verify-btn.completed:hover {
            background: #dc2626;
        }

        .verify-btn:hover {
            background: #059669;
        }

        .user-info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .logout-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 15px;
        }

        .students-list {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            padding: 15px;
        }

        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .student-item:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(5px);
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .student-id {
            color: #94a3b8;
            font-size: 14px;
        }

        .progress-info {
            text-align: center;
            margin: 0 20px;
        }

        .progress-count {
            font-size: 18px;
            font-weight: bold;
            color: #10b981;
        }

        .progress-label {
            font-size: 12px;
            color: #94a3b8;
        }

        .student-actions {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            background: #3b82f6;
            color: white;
        }

        .view-btn:hover {
            background: #2563eb;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #94a3b8;
        }

        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
        }

        .status.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            color: #a7f3d0;
        }

        .status.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #fecaca;
        }

        @media (max-width: 768px) {
            .title { font-size: 2rem; }
            .subtitle { font-size: 1.8rem; }
            .tagline { font-size: 1.2rem; }
            .bingo-board { 
                max-width: 90vw;
                height: 90vw;
            }
            .activity-list {
                max-width: 90vw;
                height: 90vw;
            }
            .activity-item {
                min-height: 100px;
                padding: 10px 5px;
            }
            .activity-item span {
                font-size: 11px;
            }
            .activity-icon {
                font-size: 1.2rem;
            }
            .verify-btn {
                font-size: 10px;
                padding: 4px 8px;
            }
            .container { padding: 10px; }
            .student-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            .student-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">GAME ON!</h1>
            <h2 class="subtitle">LEVEL UP</h2>
            <p class="tagline">GEM TRAILBLAZER SUMMER</p>
        </header>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('student')">Student</button>
                <button class="tab" onclick="switchTab('staff')">Staff</button>
            </div>

            <!-- Student Login/Register -->
            <div id="studentAuth">
                <div class="tabs">
                    <button class="tab active" onclick="switchStudentMode('login')">Login</button>
                    <button class="tab" onclick="switchStudentMode('register')">Register</button>
                </div>

                <div id="studentLogin">
                    <div id="loginStatus" class="status hidden"></div>
                    <div class="form-group">
                        <label>Student ID</label>
                        <input type="text" id="loginStudentId" placeholder="Enter your student ID">
                    </div>
                    <button class="btn" id="loginBtn" onclick="studentLogin()">Login</button>
                </div>

                <div id="studentRegister" class="hidden">
                    <div id="registerStatus" class="status hidden"></div>
                    <div class="form-group">
                        <label>Student ID</label>
                        <input type="text" id="regStudentId" placeholder="Enter your student ID">
                    </div>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="regName" placeholder="Enter your full name">
                    </div>
                    <button class="btn" id="registerBtn" onclick="studentRegister()">Register</button>
                </div>
            </div>

            <!-- Staff Login -->
            <div id="staffAuth" class="hidden">
                <div id="staffStatus" class="status hidden"></div>
                <div class="form-group">
                    <label>Staff Password</label>
                    <input type="password" id="staffPassword" placeholder="Enter staff password">
                </div>
                <button class="btn" onclick="staffLogin()">Staff Login</button>
            </div>
        </div>

        <!-- Student Dashboard -->
        <div id="studentDashboard" class="hidden">
            <div class="user-info">
                <h3>Welcome, <span id="studentName"></span>!</h3>
                <p>Student ID: <span id="displayStudentId"></span></p>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <div class="bingo-board" id="bingoBoard">
                <!-- Bingo cells will be generated here -->
            </div>
        </div>

        <!-- Staff Dashboard -->
        <div id="staffDashboard" class="hidden">
            <div class="user-info">
                <h3>Staff Verification Panel</h3>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <div class="staff-panel">
                <div class="staff-tabs">
                    <button class="staff-tab active" onclick="switchStaffTab('verify')">Verify Activities</button>
                    <button class="staff-tab" onclick="switchStaffTab('students')">All Students</button>
                </div>

                <!-- Verify Activities Tab -->
                <div id="verifyTab">
                    <div class="student-search">
                        <input type="text" id="searchStudentId" placeholder="Enter Student ID to verify">
                        <button class="btn" onclick="searchStudent()">Search Student</button>
                    </div>

                    <div id="verificationSection" class="verification-section hidden">
                        <h4>Student: <span id="verifyStudentName"></span> (<span id="verifyStudentId"></span>)</h4>
                        <div class="activity-list" id="activityList">
                            <!-- Activities will be listed here -->
                        </div>
                    </div>
                </div>

                <!-- All Students Tab -->
                <div id="studentsTab" class="hidden">
                    <h4 style="margin-bottom: 15px;">All Registered Students</h4>
                    <div id="studentsLoading" class="loading hidden">Loading students...</div>
                    <div class="students-list" id="studentsList">
                        <!-- Students will be listed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ðŸš€ INSTANT DEPLOY VERSION - NO SETUP NEEDED!
        // Uses JSONBin.io as a simple database
        
        const API_KEY = '$2a$10$Bd8Z9H1s.zJg9OkGXKvMZO2RhzzCxjwUGExSYQKbMk7XTXWpNG/d2';
        const BIN_ID = '674d8a22ad19ca34f8c2a33e';
        const BASE_URL = 'https://api.jsonbin.io/v3/b/' + BIN_ID;

        // Global variables
        let currentUser = null;
        let userType = null;
        let allData = { students: {} };

        // Bingo activities
        const bingoActivities = [
            { id: 1, title: 'Take a Picture with Merlion', icon: 'ðŸ—½' },
            { id: 2, title: "Visit NTU's Dim Sum Building", icon: 'ðŸ¢' },
            { id: 3, title: 'Activity by GEM Summer', icon: 'â­' },
            { id: 4, title: 'Take Photo with GEM Supertrees', icon: 'ðŸŒ³' },
            { id: 5, title: 'Complete GEM Summer Survey', icon: 'âœ…' },
            { id: 6, title: 'Eat Any Local Dishes', icon: 'ðŸœ' },
            { id: 7, title: 'Take a Wefie with Your Coursemates', icon: 'ðŸ‘¥' },
            { id: 8, title: "Take a Photo with Singapore's National Flower", icon: 'ðŸŒº' },
            { id: 9, title: 'Find One GEM Summer Coin', icon: 'ðŸª™' }
        ];

        // Utility functions
        function showStatus(elementId, message, type) {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
            
            if (type === 'success') {
                setTimeout(() => statusEl.classList.add('hidden'), 3000);
            }
        }

        function hideStatus(elementId) {
            document.getElementById(elementId).classList.add('hidden');
        }

        function setLoading(btnId, loading) {
            const btn = document.getElementById(btnId);
            btn.disabled = loading;
            btn.textContent = loading ? 'Loading...' : (btn.getAttribute('data-text') || 'Submit');
        }

        // API functions
        async function loadData() {
            try {
                const response = await fetch(BASE_URL + '/latest', {
                    headers: { 'X-Master-Key': API_KEY }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    allData = data.record || { students: {} };
                } else {
                    allData = { students: {} };
                }
            } catch (error) {
                console.log('Using offline mode');
                allData = { students: {} };
            }
        }

        async function saveData() {
            try {
                await fetch(BASE_URL, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Master-Key': API_KEY
                    },
                    body: JSON.stringify(allData)
                });
            } catch (error) {
                console.log('Save failed - using offline mode');
            }
        }

        // UI Functions
        window.switchTab = function(type) {
            document.querySelectorAll('.tabs .tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            if (type === 'student') {
                document.getElementById('studentAuth').classList.remove('hidden');
                document.getElementById('staffAuth').classList.add('hidden');
            } else {
                document.getElementById('studentAuth').classList.add('hidden');
                document.getElementById('staffAuth').classList.remove('hidden');
            }
        };

        window.switchStudentMode = function(mode) {
            document.querySelectorAll('#studentAuth .tabs .tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            hideStatus('loginStatus');
            hideStatus('registerStatus');
            
            if (mode === 'login') {
                document.getElementById('studentLogin').classList.remove('hidden');
                document.getElementById('studentRegister').classList.add('hidden');
            } else {
                document.getElementById('studentLogin').classList.add('hidden');
                document.getElementById('studentRegister').classList.remove('hidden');
            }
        };

        window.switchStaffTab = function(tab) {
            document.querySelectorAll('.staff-tabs .staff-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'verify') {
                document.getElementById('verifyTab').classList.remove('hidden');
                document.getElementById('studentsTab').classList.add('hidden');
            } else {
                document.getElementById('verifyTab').classList.add('hidden');
                document.getElementById('studentsTab').classList.remove('hidden');
                loadAllStudents();
            }
        };

        // Authentication Functions
        window.studentRegister = async function() {
            const studentId = document.getElementById('regStudentId').value.trim();
            const name = document.getElementById('regName').value.trim();

            hideStatus('registerStatus');

            if (!studentId || !name) {
                showStatus('registerStatus', 'Please fill in both Student ID and Name', 'error');
                return;
            }

            if (allData.students[studentId]) {
                showStatus('registerStatus', 'Student ID already exists', 'error');
                return;
            }

            try {
                setLoading('registerBtn', true);
                
                allData.students[studentId] = {
                    name: name,
                    completedActivities: [],
                    createdAt: new Date().toISOString()
                };

                await saveData();
                showStatus('registerStatus', 'Registration successful! You can now login.', 'success');
                
                // Clear form
                document.getElementById('regStudentId').value = '';
                document.getElementById('regName').value = '';

            } catch (error) {
                showStatus('registerStatus', 'Registration failed. Please try again.', 'error');
            } finally {
                setLoading('registerBtn', false);
            }
        };

        window.studentLogin = async function() {
            const studentId = document.getElementById('loginStudentId').value.trim();

            hideStatus('loginStatus');

            if (!studentId) {
                showStatus('loginStatus', 'Please enter your Student ID', 'error');
                return;
            }

            try {
                setLoading('loginBtn', true);
                await loadData();
                
                if (!allData.students[studentId]) {
                    showStatus('loginStatus', 'Student ID not found. Please register first.', 'error');
                    return;
                }

                currentUser = studentId;
                userType = 'student';
                showStudentDashboard();

            } catch (error) {
                showStatus('loginStatus', 'Login failed. Please try again.', 'error');
            } finally {
                setLoading('loginBtn', false);
            }
        };

        window.staffLogin = function() {
            const password = document.getElementById('staffPassword').value;

            hideStatus('staffStatus');

            if (!password) {
                showStatus('staffStatus', 'Please enter staff password', 'error');
                return;
            }

            if (password === 'admin123') {
                currentUser = 'staff';
                userType = 'staff';
                showStaffDashboard();
            } else {
                showStatus('staffStatus', 'Invalid staff password', 'error');
            }
        };

        function showStudentDashboard() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('studentDashboard').classList.remove('hidden');
            document.getElementById('studentName').textContent = allData.students[currentUser].name;
            document.getElementById('displayStudentId').textContent = currentUser;
            generateBingoBoard();
        }

        function showStaffDashboard() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('staffDashboard').classList.remove('hidden');
        }

        function generateBingoBoard() {
            const boardElement = document.getElementById('bingoBoard');
            boardElement.innerHTML = '';

            bingoActivities.forEach(activity => {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                
                if (allData.students[currentUser].completedActivities.includes(activity.id)) {
                    cell.classList.add('completed');
                }

                cell.innerHTML = `
                    <div class="cell-icon">${activity.icon}</div>
                    <div class="cell-title">${activity.title}</div>
                `;

                boardElement.appendChild(cell);
            });
        }

        // Staff Functions
        window.searchStudent = async function() {
            const studentId = document.getElementById('searchStudentId').value.trim();
            
            if (!studentId) {
                alert('Please enter a Student ID');
                return;
            }

            await loadData();

            if (!allData.students[studentId]) {
                alert('Student not found');
                return;
            }

            document.getElementById('verifyStudentName').textContent = allData.students[studentId].name;
            document.getElementById('verifyStudentId').textContent = studentId;
            document.getElementById('verificationSection').classList.remove('hidden');
            
            generateActivityList(studentId);
        };

        function generateActivityList(studentId) {
            const listElement = document.getElementById('activityList');
            listElement.innerHTML = '';

            bingoActivities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                
                const isCompleted = allData.students[studentId].completedActivities.includes(activity.id);
                
                item.innerHTML = `
                    <span>
                        <div class="activity-icon">${activity.icon}</div>
                        <div>${activity.title}</div>
                    </span>
                    <button class="verify-btn ${isCompleted ? 'completed' : ''}" 
                            onclick="toggleActivity('${studentId}', ${activity.id})">
                        ${isCompleted ? 'Undo' : 'Verify'}
                    </button>
                `;

                listElement.appendChild(item);
            });
        }

        window.toggleActivity = async function(studentId, activityId) {
            const completedActivities = allData.students[studentId].completedActivities;
            const index = completedActivities.indexOf(activityId);
            
            if (index > -1) {
                completedActivities.splice(index, 1);
                alert('Activity undone successfully!');
            } else {
                completedActivities.push(activityId);
                alert('Activity verified successfully!');
            }
            
            await saveData();
            generateActivityList(studentId);
            
            // Update student view if they're logged in
            if (currentUser === studentId && userType === 'student') {
                generateBingoBoard();
            }
        };

        async function loadAllStudents() {
            const listElement = document.getElementById('studentsList');
            const loadingElement = document.getElementById('studentsLoading');
            
            try {
                loadingElement.classList.remove('hidden');
                listElement.innerHTML = '';

                await loadData();

                if (Object.keys(allData.students).length === 0) {
                    listElement.innerHTML = '<p style="text-align: center; color: #94a3b8;">No students registered yet.</p>';
                    return;
                }

                Object.keys(allData.students).forEach(studentId => {
                    const student = allData.students[studentId];
                    const completedCount = student.completedActivities.length;
                    
                    const item = document.createElement('div');
                    item.className = 'student-item';
                    
                    item.innerHTML = `
                        <div class="student-info">
                            <div class="student-name">${student.name}</div>
                            <div class="student-id">ID: ${studentId}</div>
                        </div>
                        <div class="progress-info">
                            <div class="progress-count">${completedCount}/9</div>
                            <div class="progress-label">Completed</div>
                        </div>
                        <div class="student-actions">
                            <button class="view-btn" onclick="viewStudent('${studentId}')">View</button>
                        </div>
                    `;

                    listElement.appendChild(item);
                });

            } catch (error) {
                listElement.innerHTML = '<p style="text-align: center; color: #ef4444;">Error