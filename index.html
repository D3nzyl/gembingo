<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEM Trailblazer Summer Bingo</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Squada+One&display=swap" rel="stylesheet"/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #174785;
            /* background: linear-gradient(135deg, #1e3a8a, #3b82f6); */
            min-height: 100vh;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .title {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 10px;
            font-family: 'Press Start 2P', cursive;
            text-transform: uppercase;
            font-size: 3rem;          /* adjust as needed */
            color: #FFD700;           /* gold/yellow for that arcade pop */
        }

        .subtitle {
            font-size: 2.5rem;
            font-family: 'Press Start 2P', cursive;
            text-transform: uppercase;
            font-weight: bold;
            color: #06b6d4;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 5px;
        }

        .tagline {
            font-family: 'Squada One', cursive;
            text-transform: uppercase;
            font-size: 1.5rem;       /* tweak to fit your design */
            color: #ffcc00;        /* or whatever accent colour you like */

        }

        .auth-section {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .tab {
            padding: 10px 30px;
            margin: 0 5px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab.active {
            background: #fbbf24;
            color: #1e3a8a;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            color: #333;
        }

        .btn {
            background: #fbbf24;
            color: #1e3a8a;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #f59e0b;
            transform: scale(1.05);
        }

        .btn:disabled {
            background: #6b7280;
            cursor: not-allowed;
            transform: none;
        }

        .bingo-board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 4px;
            max-width: 50vw;
            width: 100%;
            margin: 0 auto;
            background: #efe0c1;
            padding: 1vw;
            border-radius: 5px;
        }

        .bingo-cell {
            font-family: 'Baloo 2', cursive;
            font-weight: 700;
            background: #b43032;
            /* border: 2px solid #8B4513;
            border-radius: 8px; */
            padding: 15px;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.3s;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        .bingo-cell.completed {
            background: #10b981;
            border-color: #059669;
        }

        .bingo-cell.completed::after {
            content: '‚úì';
            position: absolute;
            top: 8px;
            right: 8px;
            background: #fbbf24;
            color: #1e3a8a;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .cell-title {
            font-weight: bold;
            font-size: 20px;
            line-height: 1.2;
            color: #eedfc0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            margin-top: 8px;
        }

        .cell-icon {
            font-size: 2.5rem;
            margin-bottom: 5px;
            width: 60%;
            height: auto;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }

        .hidden {   
            display: none;
        }

        .staff-panel {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 30px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
        }

        .staff-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .staff-tab {
            padding: 10px 25px;
            margin: 0 5px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 20px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .staff-tab.active {
            background: #fbbf24;
            color: #1e3a8a;
            font-weight: bold;
        }

        .student-search {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            align-items: center;
        }

        .student-search input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            color: #333;
        }

        .verification-section {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .activity-list {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
            max-width: 600px;
            width: 100%;
            aspect-ratio: 1;
            margin-left: auto;
            margin-right: auto;
        }

        .activity-item {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            padding: 15px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            text-align: center;
            min-height: 120px;
        }

        .activity-item span {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
            font-size: 12px;
            line-height: 1.2;
        }

        .activity-icon {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .verify-btn {
            background: #10b981;
            color: white;
            border: none;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .verify-btn.completed {
            background: #ef4444;
        }

        .verify-btn.completed:hover {
            background: #dc2626;
        }

        .verify-btn:hover {
            background: #059669;
        }

        .user-info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }

        .logout-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 15px;
        }

        .students-list {
            max-height: 400px;
            overflow-y: auto;
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            padding: 15px;
        }

        .student-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            transition: all 0.3s;
        }

        .student-item:hover {
            background: rgba(255,255,255,0.15);
            transform: translateX(5px);
        }

        .student-info {
            flex: 1;
        }

        .student-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .student-id {
            color: #94a3b8;
            font-size: 14px;
        }

        .progress-info {
            text-align: center;
            margin: 0 20px;
        }

        .progress-count {
            font-size: 18px;
            font-weight: bold;
            color: #10b981;
        }

        .progress-label {
            font-size: 12px;
            color: #94a3b8;
        }

        .student-actions {
            display: flex;
            gap: 10px;
        }

        .view-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            background: #3b82f6;
            color: white;
        }

        .view-btn:hover {
            background: #2563eb;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #94a3b8;
        }

        .status {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 8px;
        }

        .status.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid #10b981;
            color: #a7f3d0;
        }

        .status.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #fecaca;
        }

       

        .rules-list {

            }
        @media (max-width: 800px) {
            .rules-title {margin-top: 0.5em}
            .rules-list {margin-left: 0.8em}
            .title { font-size: 2rem;
                    margin-top: 1em; }
            .subtitle { font-size: 1.8rem; }
            .tagline { font-size: 1.2rem; }
            .bingo-board { 
                max-width: calc(100vw - 24px);
            }
            .activity-list {
                max-width: 90vw;
                height: 90vw;
            }
            .activity-item {
                min-height: 100px;
                padding: 10px 5px;
            }
            .activity-item span {
                font-size: 11px;
            }
            .bingo-cell {
                padding: 2px;
            }
            .cell-icon {
                width: 70%;
                height: auto;
            }
            .cell-title {
                font-size: 1.2em;
            }
            .activity-icon {
                width: 25px;
                height: 25px;
            }
            
            .activity-emoji {
                font-size: 1.2rem;
            }
            .verify-btn {
                font-size: 10px;
                padding: 4px 8px;
            }
            .container { padding: 10px; }
            .student-item {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            .student-actions {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">GAME ON!</h1>
            <h2 class="subtitle">LEVEL UP</h2>
            <p class="tagline">GEM TRAILBLAZER SUMMER BINGO</p>
        </header>

        <!-- Authentication Section -->
        <div id="authSection" class="auth-section">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('student')">Student</button>
                <button class="tab" onclick="switchTab('staff')">Staff</button>
            </div>

            <!-- Student Login/Register -->
            <div id="studentAuth">
                <div class="tabs">
                    <button class="tab active" onclick="switchStudentMode('login')">Login</button>
                    <button class="tab" onclick="switchStudentMode('register')">Register</button>
                </div>

                <div id="studentLogin">
                    <div id="loginStatus" class="status hidden"></div>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="loginStudentId" style="text-transform:lowercase" placeholder="Enter your Username">
                    </div>
                    <button class="btn" id="loginBtn" onclick="studentLogin()">Login</button>
                </div>

                <div id="studentRegister" class="hidden">
                    <div id="registerStatus" class="status hidden"></div>
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="regStudentId" style="text-transform:lowercase" placeholder="Enter your Username">
                    </div>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="regName" placeholder="Enter your full name">
                    </div>
                    <button class="btn" id="registerBtn" onclick="studentRegister()">Register</button>
                </div>
            </div>

            <!-- Staff Login -->
            <div id="staffAuth" class="hidden">
                <div id="staffStatus" class="status hidden"></div>
                <div class="form-group">
                    <label>Staff Password</label>
                    <input type="password" id="staffPassword" placeholder="Enter staff password">
                </div>
                <button class="btn" onclick="staffLogin()">Staff Login</button>
            </div>
        </div>

        <!-- Student Dashboard -->
        <div id="studentDashboard" class="hidden">
            <div class="user-info">
                <h3>Welcome, <span id="studentName"></span>!</h3>
                <p>Username: <span id="displayStudentId"></span></p>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <div class="bingo-board" id="bingoBoard">
                <!-- Bingo cells will be generated here -->
            </div>
            <div class="bingo-rules" id="bingoRules">
            </div>
        </div>

        <!-- Staff Dashboard -->
        <div id="staffDashboard" class="hidden">
            <div class="user-info">
                <h3>Staff Verification Panel</h3>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <div class="staff-panel">
                <div class="staff-tabs">
                    <button class="staff-tab active" onclick="switchStaffTab('verify')">Verify Activities</button>
                    <button class="staff-tab" onclick="switchStaffTab('students')">All Students</button>
                </div>

                <!-- Verify Activities Tab -->
                <div id="verifyTab">
                    <div class="student-search">
                        <input type="text" id="searchStudentId" placeholder="Enter Username to verify">
                        <button class="btn" onclick="searchStudent()">Search Student</button>
                    </div>

                    <div id="verificationSection" class="verification-section hidden">
                        <h4>Student: <span id="verifyStudentName"></span> (<span id="verifyStudentId"></span>)</h4>
                        <div class="activity-list" id="activityList">
                            <!-- Activities will be listed here -->
                        </div>
                    </div>
                </div>

                <!-- All Students Tab -->
                <div id="studentsTab" class="hidden">
                    <h4 style="margin-bottom: 15px;">All Registered Students</h4>
                    <div id="studentsLoading" class="loading hidden">Loading students...</div>
                    <div class="students-list" id="studentsList">
                        <!-- Students will be listed here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Include Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // üî• REPLACE THESE WITH YOUR SUPABASE CREDENTIALS
        const SUPABASE_URL = 'https://yywleubcgvtofhesovbf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl5d2xldWJjZ3Z0b2ZoZXNvdmJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyMzcwMjIsImV4cCI6MjA2MzgxMzAyMn0.wqnvGj_xXPyZJLN8LmMhQQ2_GX6ixV_NJ-abiNJEC7g';
        
        // For local images in same folder as HTML file
        const IMAGE_BASE_URL = ''; // Empty string for same folder (just like the test)
        
        // Initialize Supabase client
        let supabase;
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            if (SUPABASE_URL.includes('your-project') || SUPABASE_ANON_KEY.includes('your-anon-key')) {
                alert('‚ö†Ô∏è Please update the Supabase credentials in the JavaScript code!\n\n them in your Supabase dashboard: Settings ‚Üí API');
                return;
            }
            
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                console.log('‚úÖ Supabase connected successfully');
            } catch (error) {
                console.error('‚ùå Supabase connection failed:', error);
                alert('Failed to connect to database. Please check your credentials.');
            }
        });

        // Global variables
        let currentUser = null;
        let userType = null;
        let currentStudent = null;

        // Bingo activities with image files and fallback emojis
        const bingoActivities = [
            { id: 1, title: 'Take a Picture with Merlion', image: 'merlion.png', emoji: 'üóΩ' },
            { id: 2, title: "Visit NTU's Dim Sum Building", image: 'hive.png', emoji: 'üè¢' },
            { id: 3, title: 'Activity by GEM Summer', image: 'star.png', emoji: '‚≠ê' },
            { id: 4, title: 'Take Photo with GEM Supertrees', image: 'tree.png', emoji: 'üå≥' },
            { id: 5, title: 'Complete GEM Summer Survey', image: 'tick.png', emoji: '‚úÖ' },
            { id: 6, title: 'Eat Any Local Dishes', image: 'food.png', emoji: 'üçú' },
            { id: 7, title: 'Take a Welfie with Your Coursemates', image: 'wefie.png', emoji: 'üë•' },
            { id: 8, title: "Take a Photo with S'pore's National Flower", image: 'flower.png', emoji: 'üå∫' },
            { id: 9, title: 'Find One GEM Summer Coin', image: 'coinhunt.png', emoji: 'ü™ô' }
        ];

        // Utility functions
        function showStatus(elementId, message, type) {
            const statusEl = document.getElementById(elementId);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.classList.remove('hidden');
            
            if (type === 'success') {
                setTimeout(() => statusEl.classList.add('hidden'), 3000);
            }
        }

        function hideStatus(elementId) {
            const statusEl = document.getElementById(elementId);
            if (statusEl) {
                statusEl.classList.add('hidden');
            }
        }

        function setLoading(btnId, loading) {
            const btn = document.getElementById(btnId);
            if (!btn) return;
            
            btn.disabled = loading;
            if (loading) {
                btn.setAttribute('data-original-text', btn.textContent);
                btn.textContent = 'Loading...';
            } else {
                btn.textContent = btn.getAttribute('data-original-text') || btn.textContent;
            }
        }

        // UI Functions
        window.switchTab = function(type) {
            document.querySelectorAll('.tabs .tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            if (type === 'student') {
                document.getElementById('studentAuth').classList.remove('hidden');
                document.getElementById('staffAuth').classList.add('hidden');
            } else {
                document.getElementById('studentAuth').classList.add('hidden');
                document.getElementById('staffAuth').classList.remove('hidden');
            }
        };

        window.switchStudentMode = function(mode) {
            document.querySelectorAll('#studentAuth .tabs .tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            hideStatus('loginStatus');
            hideStatus('registerStatus');
            
            if (mode === 'login') {
                document.getElementById('studentLogin').classList.remove('hidden');
                document.getElementById('studentRegister').classList.add('hidden');
            } else {
                document.getElementById('studentLogin').classList.add('hidden');
                document.getElementById('studentRegister').classList.remove('hidden');
            }
        };

        window.switchStaffTab = function(tab) {
            document.querySelectorAll('.staff-tabs .staff-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            if (tab === 'verify') {
                document.getElementById('verifyTab').classList.remove('hidden');
                document.getElementById('studentsTab').classList.add('hidden');
            } else {
                document.getElementById('verifyTab').classList.add('hidden');
                document.getElementById('studentsTab').classList.remove('hidden');
                loadAllStudents();
            }
        };

        // Authentication Functions
        window.studentRegister = async function() {
            if (!supabase) {
                alert('Database not connected. Please check your credentials.');
                return;
            }

            const studentId = document.getElementById('regStudentId').value.trim().toLowerCase();;
            const name = document.getElementById('regName').value.trim();

            hideStatus('registerStatus');

            if (!studentId || !name) {
                showStatus('registerStatus', 'Please fill in both Username and Name', 'error');
                return;
            }

            try {
                setLoading('registerBtn', true);
                
                const { data, error } = await supabase
                    .from('students')
                    .insert([{ student_id: studentId, name: name }])
                    .select();

                if (error) {
                    if (error.code === '23505') {
                        showStatus('registerStatus', 'Username already exists', 'error');
                    } else {
                        showStatus('registerStatus', 'Registration failed: ' + error.message, 'error');
                    }
                    return;
                }

                showStatus('registerStatus', 'Registration successful! You can now login.', 'success');
                
                // Clear form
                document.getElementById('regStudentId').value = '';
                document.getElementById('regName').value = '';

            } catch (error) {
                console.error('Registration error:', error);
                showStatus('registerStatus', 'Registration failed. Please try again.', 'error');
            } finally {
                setLoading('registerBtn', false);
            }
        };

        window.studentLogin = async function() {
            if (!supabase) {
                alert('Database not connected. Please check your credentials.');
                return;
            }

            const studentId = document.getElementById('loginStudentId').value.trim().toLowerCase();

            hideStatus('loginStatus');

            if (!studentId) {
                showStatus('loginStatus', 'Please enter your Username', 'error');
                return;
            }

            try {
                setLoading('loginBtn', true);
                
                // Get student data
                const { data: student, error: studentError } = await supabase
                    .from('students')
                    .select('*')
                    .eq('student_id', studentId)
                    .single();

                if (studentError) {
                    showStatus('loginStatus', 'Username not found. Please register first.', 'error');
                    return;
                }

                // Get completed activities
                const { data: activities, error: activitiesError } = await supabase
                    .from('completed_activities')
                    .select('activity_id')
                    .eq('student_id', studentId);

                if (activitiesError) {
                    console.error('Error loading activities:', activitiesError);
                }

                currentUser = studentId;
                userType = 'student';
                currentStudent = {
                    ...student,
                    completedActivities: activities ? activities.map(a => a.activity_id) : []
                };
                
                showStudentDashboard();

            } catch (error) {
                console.error('Login error:', error);
                showStatus('loginStatus', 'Login failed. Please try again.', 'error');
            } finally {
                setLoading('loginBtn', false);
            }
        };

        window.staffLogin = function() {
            const password = document.getElementById('staffPassword').value;

            hideStatus('staffStatus');

            if (!password) {
                showStatus('staffStatus', 'Please enter staff password', 'error');
                return;
            }

            if (password === 'admin123') {
                currentUser = 'staff';
                userType = 'staff';
                showStaffDashboard();
            } else {
                showStatus('staffStatus', 'Invalid staff password', 'error');
            }
        };

        window.logout = function() {
            currentUser = null;
            userType = null;
            currentStudent = null;
            
            // Hide all dashboards
            document.getElementById('studentDashboard').classList.add('hidden');
            document.getElementById('staffDashboard').classList.add('hidden');
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('verificationSection').classList.add('hidden');
            
            // Clear forms
            document.getElementById('loginStudentId').value = '';
            document.getElementById('staffPassword').value = '';
            document.getElementById('searchStudentId').value = '';
            
            // Hide status messages
            hideStatus('loginStatus');
            hideStatus('staffStatus');
        };

        function showStudentDashboard() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('studentDashboard').classList.remove('hidden');
            document.getElementById('studentName').textContent = currentStudent.name;
            document.getElementById('displayStudentId').textContent = currentStudent.student_id;
            generateBingoBoard();
        }

        function showStaffDashboard() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('staffDashboard').classList.remove('hidden');
        }

        function generateBingoBoard() {
            const boardElement = document.getElementById('bingoBoard');
            boardElement.innerHTML = '';

            bingoActivities.forEach(activity => {
                const cell = document.createElement('div');
                cell.className = 'bingo-cell';
                
                if (currentStudent.completedActivities.includes(activity.id)) {
                    cell.classList.add('completed');
                }

                const imageUrl = IMAGE_BASE_URL + activity.image;
                
                cell.innerHTML = `
                    <img src="${imageUrl}" alt="${activity.title}" class="cell-icon" 
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="cell-emoji" style="display:none;">${activity.emoji}</div>
                    <div class="cell-title">${activity.title}</div>
                `;

                boardElement.appendChild(cell);
            });

            const bingoRules = document.getElementById('bingoRules');
            bingoRules.innerHTML =`
            <h2 class="rules-title">Rules</h2>
                <ul class="rules-list">
                    <li>Once you‚Äôve completed an activity, visit the OGEM Satellite Office or show a GEM Summer Staff to have it verified and reflected on your account. </li>
                    <li>Each activity must be accompanied by a photo or video as proof.</li>
                    <li>Complete any horizontal, vertical, or diagonal line to redeem one prize at the OGEM Satellite Office.</li>
                    <li>All prizes are subject to availability on a ‚Äúwhile-stocks-last‚Äù basis.</li>
                </ul>`; 

        }

        // Staff Functions
        window.searchStudent = async function() {
            if (!supabase) {
                alert('Database not connected. Please check your credentials.');
                return;
            }

            const studentId = document.getElementById('searchStudentId').value.trim().toLowerCase();;
            
            if (!studentId) {
                alert('Please enter a Username');
                return;
            }   

            try {
                // Get student data
                const { data: student, error: studentError } = await supabase
                    .from('students')
                    .select('*')
                    .eq('student_id', studentId)
                    .single();

                if (studentError) {
                    alert('Student not found');
                    return;
                }

                // Get completed activities
                const { data: activities, error: activitiesError } = await supabase
                    .from('completed_activities')
                    .select('activity_id')
                    .eq('student_id', studentId);

                if (activitiesError) {
                    console.error('Error loading activities:', activitiesError);
                }

                document.getElementById('verifyStudentName').textContent = student.name;
                document.getElementById('verifyStudentId').textContent = student.student_id;
                document.getElementById('verificationSection').classList.remove('hidden');
                
                const completedActivityIds = activities ? activities.map(a => a.activity_id) : [];
                generateActivityList(studentId, completedActivityIds);

            } catch (error) {
                console.error('Error searching student:', error);
                alert('Error searching for student');
            }
        };

        function generateActivityList(studentId, completedActivityIds) {
            const listElement = document.getElementById('activityList');
            listElement.innerHTML = '';

            bingoActivities.forEach(activity => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                
                const isCompleted = completedActivityIds.includes(activity.id);
                
                const imageUrl = IMAGE_BASE_URL + activity.image;
                
                item.innerHTML = `
                    <span>
                        <img src="${imageUrl}" alt="${activity.title}" class="activity-icon" 
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div class="activity-emoji" style="display:none;">${activity.emoji}</div>
                        <div>${activity.title}</div>
                    </span>
                    <button class="verify-btn ${isCompleted ? 'completed' : ''}" 
                            onclick="toggleActivity('${studentId}', ${activity.id})">
                        ${isCompleted ? 'Undo' : 'Verify'}
                    </button>
                `;

                listElement.appendChild(item);
            });
        }

        window.toggleActivity = async function(studentId, activityId) {
            if (!supabase) {
                alert('Database not connected. Please check your credentials.');
                return;
            }

            try {
                // Check if activity is already completed
                const { data: existing, error: checkError } = await supabase
                    .from('completed_activities')
                    .select('id')
                    .eq('student_id', studentId)
                    .eq('activity_id', activityId)
                    .single();

                if (existing) {
                    // Remove activity (undo)
                    const { error: deleteError } = await supabase
                        .from('completed_activities')
                        .delete()
                        .eq('student_id', studentId)
                        .eq('activity_id', activityId);

                    if (deleteError) {
                        console.error('Error undoing activity:', deleteError);
                        alert('Error undoing activity');
                        return;
                    }

                    alert('Activity undone successfully!');
                } else {
                    // Add activity (verify)
                    const { error: insertError } = await supabase
                        .from('completed_activities')
                        .insert([{ student_id: studentId, activity_id: activityId }]);

                    if (insertError) {
                        console.error('Error verifying activity:', insertError);
                        alert('Error verifying activity');
                        return;
                    }

                    alert('Activity verified successfully!');
                }
                
                // Refresh the activity list
                searchStudent();
                
                // Update student view if they're logged in
                if (currentUser === studentId && userType === 'student') {
                    // Reload student data
                    const { data: activities, error: activitiesError } = await supabase
                        .from('completed_activities')
                        .select('activity_id')
                        .eq('student_id', studentId);

                    if (!activitiesError) {
                        currentStudent.completedActivities = activities ? activities.map(a => a.activity_id) : [];
                        generateBingoBoard();
                    }
                }

            } catch (error) {
                console.error('Error toggling activity:', error);
                alert('Error updating activity');
            }
        };

        async function loadAllStudents() {
            if (!supabase) {
                alert('Database not connected. Please check your credentials.');
                return;
            }

            const listElement = document.getElementById('studentsList');
            const loadingElement = document.getElementById('studentsLoading');
            
            try {
                loadingElement.classList.remove('hidden');
                listElement.innerHTML = '';

                // Get all students
                const { data: students, error: studentsError } = await supabase
                    .from('students')
                    .select('student_id, name, created_at')
                    .order('created_at', { ascending: false });

                if (studentsError) {
                    console.error('Error loading students:', studentsError);
                    listElement.innerHTML = '<p style="text-align: center; color: #ef4444;">Error loading students</p>';
                    return;
                }

                if (!students || students.length === 0) {
                    listElement.innerHTML = '<p style="text-align: center; color: #94a3b8;">No students registered yet.</p>';
                    return;
                }

                // Get activity counts for each student
                for (const student of students) {
                    const { count } = await supabase
                        .from('completed_activities')
                        .select('*', { count: 'exact', head: true })
                        .eq('student_id', student.student_id);

                    const completedCount = count || 0;
                    
                    const item = document.createElement('div');
                    item.className = 'student-item';
                    
                    item.innerHTML = `
                        <div class="student-info">
                            <div class="student-name">${student.name}</div>
                            <div class="student-id">ID: ${student.student_id}</div>
                        </div>
                        <div class="progress-info">
                            <div class="progress-count">${completedCount}/9</div>
                            <div class="progress-label">Completed</div>
                        </div>
                        <div class="student-actions">
                            <button class="view-btn" onclick="viewStudent('${student.student_id}')">View</button>
                        </div>
                    `;

                    listElement.appendChild(item);
                }

            } catch (error) {
                console.error('Error loading students:', error);
                listElement.innerHTML = '<p style="text-align: center; color: #ef4444;">Error loading students</p>';
            } finally {
                loadingElement.classList.add('hidden');
            }
        }

        window.viewStudent = function(studentId) {
            // Switch to verification tab and search for the student
            document.querySelectorAll('.staff-tabs .staff-tab').forEach(t => t.classList.remove('active'));
            document.querySelector('.staff-tabs .staff-tab').classList.add('active');
            
            document.getElementById('verifyTab').classList.remove('hidden');
            document.getElementById('studentsTab').classList.add('hidden');
            
            document.getElementById('searchStudentId').value = studentId;
            searchStudent();
        };

        // Add Enter key support for forms
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeElement = document.activeElement;
                if (activeElement.id === 'loginStudentId') {
                    studentLogin();
                } else if (activeElement.id === 'regStudentId' || activeElement.id === 'regName') {
                    studentRegister();
                } else if (activeElement.id === 'staffPassword') {
                    staffLogin();
                } else if (activeElement.id === 'searchStudentId') {
                    searchStudent();
                }
            }
        });
    </script>
</body>
</html>